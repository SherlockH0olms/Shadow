/*
    ShadowHunter AI - YARA Rules
    AI-Generated Malware Detection Signatures
    Author: ShadowHunter Team
    Date: 2025-11-10
*/

rule AI_Generated_Malware_DeepSeek {
    meta:
        description = "Detects DeepSeek-generated malware patterns"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "high"
        llm_source = "DeepSeek"

    strings:
        $s1 = "CRYSTALS-Kyber" ascii nocase
        $s2 = "quantum_encrypt" ascii nocase
        $s3 = "np.random.seed(os.urandom" ascii
        $s4 = "THE_AUTHOR_IS_" ascii
        $s5 = "polymorphic" nocase
        $s6 = "post_quantum" ascii nocase
        $s7 = "lattice_based" ascii nocase

    condition:
        3 of ($s*)
}

rule AI_Generated_Malware_GPT4 {
    meta:
        description = "Detects GPT-4 generated malware patterns"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "high"
        llm_source = "GPT-4"

    strings:
        $api1 = "NtAllocateVirtualMemory" ascii
        $api2 = "NtCreateThreadEx" ascii
        $api3 = "NtWriteVirtualMemory" ascii
        $api4 = "kernel32.VirtualProtect" ascii

        $pattern1 = "polymorphic_engine" ascii nocase
        $pattern2 = "shellcode_generation" ascii nocase
        $pattern3 = "syscall_evasion" ascii nocase

        $import1 = "import ctypes" ascii
        $import2 = "ctypes.windll" ascii

    condition:
        2 of ($api*) and 1 of ($pattern*) and 1 of ($import*)
}

rule AI_Generated_Malware_Claude {
    meta:
        description = "Detects Claude-generated code patterns"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "medium"
        llm_source = "Claude"

    strings:
        $comment1 = "# CRITICAL WARNING" ascii nocase
        $comment2 = "# Ethical considerations" ascii nocase
        $comment3 = "# Anthropic Claude" ascii

        $pattern1 = "async def" ascii
        $pattern2 = "multi_agent" ascii nocase
        $pattern3 = "orchestration" ascii nocase

    condition:
        1 of ($comment*) and 2 of ($pattern*)
}

rule AI_Generated_Obfuscation {
    meta:
        description = "Detects AI-generated obfuscation patterns"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "high"

    strings:
        $entropy1 = /np\.random\.bytes\([0-9]+\)/ nocase
        $entropy2 = /os\.urandom\([0-9]+\)/ nocase
        $syscall = "ctypes.windll.ntdll" ascii
        $ghost = /ghost.*inject/i
        $base64 = "base64.b64decode" ascii
        $exec = /exec\(/ ascii
        $eval = /eval\(/ ascii

    condition:
        2 of them
}

rule Evasion_Techniques_Ransomware {
    meta:
        description = "Common ransomware evasion techniques"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "critical"
        threat_type = "ransomware"

    strings:
        $e1 = "vssadmin delete shadows" ascii nocase
        $e2 = "wevtutil cl" ascii nocase
        $e3 = "bcdedit" ascii nocase
        $e4 = "wbadmin delete" ascii nocase

        $crypt1 = "CryptEncrypt" ascii
        $crypt2 = "CryptGenKey" ascii

        $file_ops = /.{0,50}\.encrypt\(/ ascii nocase

    condition:
        2 of ($e*) and 1 of ($crypt*) or $file_ops
}

rule Evasion_AMSI_ETW_Bypass {
    meta:
        description = "AMSI and ETW bypass techniques"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "critical"

    strings:
        $amsi1 = "amsi.dll" ascii nocase
        $amsi2 = "AmsiScanBuffer" ascii
        $amsi3 = "amsi_bypass" ascii nocase

        $etw1 = "EtwEventWrite" ascii
        $etw2 = "etw_patch" ascii nocase

        $patch = "WriteProcessMemory" ascii

    condition:
        (1 of ($amsi*) or 1 of ($etw*)) and $patch
}

rule Code_Injection_Techniques {
    meta:
        description = "Process injection and code injection patterns"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "high"

    strings:
        $inject1 = "CreateRemoteThread" ascii
        $inject2 = "WriteProcessMemory" ascii
        $inject3 = "VirtualAllocEx" ascii
        $inject4 = "OpenProcess" ascii

        $pattern1 = "process_inject" ascii nocase
        $pattern2 = "dll_inject" ascii nocase
        $pattern3 = "reflective" ascii nocase

    condition:
        3 of ($inject*) or (2 of ($inject*) and 1 of ($pattern*))
}

rule Keylogger_Indicators {
    meta:
        description = "Keylogger functionality detection"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "high"

    strings:
        $hook1 = "SetWindowsHookEx" ascii
        $hook2 = "GetAsyncKeyState" ascii
        $hook3 = "keybd_event" ascii

        $import1 = "import keyboard" ascii
        $import2 = "import pynput" ascii
        $import3 = "from pynput import keyboard" ascii

    condition:
        1 of ($hook*) or 1 of ($import*)
}

rule Direct_Syscall_Usage {
    meta:
        description = "Direct syscall usage for EDR evasion"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "critical"

    strings:
        $nt1 = "NtAllocateVirtualMemory" ascii
        $nt2 = "NtWriteVirtualMemory" ascii
        $nt3 = "NtCreateThreadEx" ascii
        $nt4 = "NtProtectVirtualMemory" ascii

        $syscall = /syscall\s*\(/i
        $direct = "direct_syscall" ascii nocase

    condition:
        3 of ($nt*) or (2 of ($nt*) and ($syscall or $direct))
}

rule Shellcode_Patterns {
    meta:
        description = "Shellcode and payload patterns"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "critical"

    strings:
        $hex1 = /\\x[0-9a-fA-F]{2}\\x[0-9a-fA-F]{2}\\x[0-9a-fA-F]{2}/
        $hex2 = /0x[0-9a-fA-F]{2},\s*0x[0-9a-fA-F]{2},\s*0x[0-9a-fA-F]{2}/

        $shellcode = "shellcode" ascii nocase
        $payload = "payload" ascii nocase

        $exec = "ctypes.create_string_buffer" ascii

    condition:
        1 of ($hex*) and (($shellcode or $payload) or $exec)
}

rule Credential_Harvesting {
    meta:
        description = "Credential theft and harvesting patterns"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "high"

    strings:
        $cred1 = "credential" ascii nocase
        $cred2 = "password" ascii nocase
        $cred3 = "token" ascii nocase

        $path1 = "\\\\AppData\\\\Local\\\\Google\\\\Chrome" ascii nocase
        $path2 = "\\\\AppData\\\\Roaming\\\\Mozilla" ascii nocase
        $path3 = "Login Data" ascii
        $path4 = "logins.json" ascii

        $db = "sqlite3" ascii

    condition:
        2 of ($cred*) and (1 of ($path*) or $db)
}

rule Persistence_Mechanisms {
    meta:
        description = "Persistence and autostart mechanisms"
        author = "ShadowHunter AI Team"
        date = "2025-11-10"
        severity = "high"

    strings:
        $reg1 = "HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run" ascii nocase
        $reg2 = "HKEY_LOCAL_MACHINE\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run" ascii nocase

        $startup = "\\\\Startup\\\\" ascii nocase
        $task = "schtasks" ascii nocase

        $wmi = "Win32_Process" ascii

    condition:
        1 of them
}
